#!/usr/bin/env ruby
# frozen_string_literal: true

require 'dotenv/load'
require 'json'
require_relative '../lib/shared/openai_magic'

OPENAI_API_KEY = ENV['OPENAI_API_KEY']

if OPENAI_API_KEY.nil?
  puts 'Missing OpenAI Key, please update .env file.'
  exit 1
end

question, = ARGV

if question.nil?
  puts 'No question provided. Please provide a single quoted argument to OpenAI.'
  exit 1
end

# We have everything we need....
ai_magic = OpenAIMagic.new(OPENAI_API_KEY)
answer = ai_magic.get_completion(question)

puts "Q: #{question}"
print 'A: '
# Silly, but fun...
answer.chars.each do |c|
  print c
  sleep(0.05)
end
